using System.Collections.Generic;
using UnityEngine;


public class CubeSpawner : MonoBehaviour
{
    [SerializeField] private List<Cube> _cubes;
    private int _divider = 2;
    private int _minCubes = 2;
    private int _maxCubes = 7;

    private void OnEnable()
    {
        foreach (var cube in _cubes)
        {
            cube.OnCubeClicked += HandleCubeClicked;
        }
    }

    private void OnDisable()
    {
        foreach (var cube in _cubes)
        {
            cube.OnCubeClicked -= HandleCubeClicked;
        }
    }

    private void HandleCubeClicked(Cube cube)
    {
        CreateCubes(cube);
    }

    private void CreateCubes(Cube cube)
    {
        int randomNumber = Random.Range(_minCubes, _maxCubes);
        cube.ChangeCubeColor();
        cube.transform.localScale /= _divider;

        for (int i = 0; i < randomNumber; i++)
        {
            cube = Instantiate(cube, cube.transform.localPosition, Quaternion.identity);
            cube.OnCubeClicked += HandleCubeClicked;
        }

        cube._splitChance /= _divider;
        cube.OnCubeClicked -= HandleCubeClicked;
    }
}
